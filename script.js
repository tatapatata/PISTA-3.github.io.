document.addEventListener('DOMContentLoaded', () => {
    const pixelGrid = document.getElementById('pixel-grid');
    const colorButtons = document.querySelectorAll('.color-button');
    const completionMessage = document.getElementById('completion-message');
    let selectedColor = null;
    let paintedPixelsCount = 0;

    const colors = {
        '1': 'var(--color-1)',
        '2': 'var(--color-2)',
        '3': 'var(--color-3)',
        '4': 'var(--color-4)',
        '5': 'var(--color-5)',
        '6': 'var(--color-6)',
        '7': 'var(--color-7)',
        '8': 'var(--color-8)',
        '9': 'var(--color-9)',
        '10': 'var(--color-10)'
    };

    // --- MATRIZ FINAL PARA EL PANDA ROJO Y EL MAPACHE CON LOS COLORES DE LA IMAGEN ---
    const imagePattern = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    ];

    // Rellenando la matriz con los colores de la imagen
    const patternData = [
        // Panda Rojo
        [12, 18, 7], [12, 19, 7], [12, 20, 7], [12, 21, 7], [12, 22, 7],
        [13, 17, 7], [13, 18, 7], [13, 19, 7], [13, 20, 7], [13, 21, 7], [13, 22, 7], [13, 23, 7],
        [14, 16, 7], [14, 17, 7], [14, 18, 7], [14, 19, 7], [14, 20, 7], [14, 21, 7], [14, 22, 7], [14, 23, 7], [14, 24, 7],
        [15, 15, 7], [15, 16, 7], [15, 17, 7], [15, 18, 7], [15, 19, 7], [15, 20, 7], [15, 21, 7], [15, 22, 7], [15, 23, 7], [15, 24, 7], [15, 25, 7],
        [16, 14, 7], [16, 15, 7], [16, 16, 7], [16, 17, 7], [16, 18, 7], [16, 19, 7], [16, 20, 7], [16, 21, 7], [16, 22, 7], [16, 23, 7], [16, 24, 7], [16, 25, 7], [16, 26, 7],
        [17, 13, 7], [17, 14, 7], [17, 15, 7], [17, 16, 7], [17, 17, 7], [17, 18, 7], [17, 19, 7], [17, 20, 7], [17, 21, 7], [17, 22, 7], [17, 23, 7], [17, 24, 7], [17, 25, 7], [17, 26, 7], [17, 27, 7],
        [18, 12, 7], [18, 13, 7], [18, 14, 7], [18, 15, 7], [18, 16, 7], [18, 17, 7], [18, 18, 7], [18, 19, 7], [18, 20, 7], [18, 21, 7], [18, 22, 7], [18, 23, 7], [18, 24, 7], [18, 25, 7], [18, 26, 7], [18, 27, 7], [18, 28, 7],
        [19, 12, 7], [19, 13, 7], [19, 14, 7], [19, 15, 7], [19, 16, 7], [19, 17, 7], [19, 18, 7], [19, 19, 7], [19, 20, 7], [19, 21, 7], [19, 22, 7], [19, 23, 7], [19, 24, 7], [19, 25, 7], [19, 26, 7], [19, 27, 7], [19, 28, 7],
        [20, 13, 7], [20, 14, 7], [20, 15, 7], [20, 16, 7], [20, 17, 7], [20, 18, 7], [20, 19, 7], [20, 20, 7], [20, 21, 7], [20, 22, 7], [20, 23, 7], [20, 24, 7], [20, 25, 7], [20, 26, 7], [20, 27, 7],
        [21, 14, 7], [21, 15, 7], [21, 16, 7], [21, 17, 7], [21, 18, 7], [21, 19, 7], [21, 20, 7], [21, 21, 7], [21, 22, 7], [21, 23, 7], [21, 24, 7], [21, 25, 7], [21, 26, 7],
        [22, 15, 7], [22, 16, 7], [22, 17, 7], [22, 18, 7], [22, 19, 7], [22, 20, 7], [22, 21, 7], [22, 22, 7], [22, 23, 7], [22, 24, 7], [22, 25, 7],
        [23, 16, 7], [23, 17, 7], [23, 18, 7], [23, 19, 7], [23, 20, 7], [23, 21, 7], [23, 22, 7], [23, 23, 7], [23, 24, 7],
        [24, 17, 7], [24, 18, 7], [24, 19, 7], [24, 20, 7], [24, 21, 7], [24, 22, 7], [24, 23, 7],
        [25, 18, 7], [25, 19, 7], [25, 20, 7], [25, 21, 7], [25, 22, 7],
        [26, 19, 7], [26, 20, 7], [26, 21, 7],

        // Mapache
        [15, 29, 3], [15, 30, 3], [15, 31, 3], [15, 32, 3], [15, 33, 3], [15, 34, 3], [15, 35, 3], [15, 36, 3], [15, 37, 3],
        [16, 29, 3], [16, 30, 3], [16, 31, 3], [16, 32, 3], [16, 33, 3], [16, 34, 3], [16, 35, 3], [16, 36, 3], [16, 37, 3], [16, 38, 3],
        [17, 28, 3], [17, 29, 3], [17, 30, 3], [17, 31, 3], [17, 32, 3], [17, 33, 3], [17, 34, 3], [17, 35, 3], [17, 36, 3], [17, 37, 3], [17, 38, 3], [17, 39, 3],
        [18, 28, 3], [18, 29, 3], [18, 30, 3], [18, 31, 3], [18, 32, 3], [18, 33, 3], [18, 34, 3], [18, 35, 3], [18, 36, 3], [18, 37, 3], [18, 38, 3], [18, 39, 3],
        [19, 28, 3], [19, 29, 3], [19, 30, 3], [19, 31, 3], [19, 32, 3], [19, 33, 3], [19, 34, 3], [19, 35, 3], [19, 36, 3], [19, 37, 3], [19, 38, 3], [19, 39, 3],
        [20, 29, 3], [20, 30, 3], [20, 31, 3], [20, 32, 3], [20, 33, 3], [20, 34, 3], [20, 35, 3], [20, 36, 3], [20, 37, 3], [20, 38, 3],
        [21, 30, 3], [21, 31, 3], [21, 32, 3], [21, 33, 3], [21, 34, 3], [21, 35, 3], [21, 36, 3], [21, 37, 3],
        [22, 31, 3], [22, 32, 3], [22, 33, 3], [22, 34, 3], [22, 35, 3], [22, 36, 3],
        [23, 32, 3], [23, 33, 3], [23, 34, 3], [23, 35, 3],
        [24, 33, 3], [24, 34, 3],

        // Rasgos y detalles del Mapache
        [15, 31, 10], [15, 34, 10], // Ojos negros
        [17, 32, 9], // Nariz
        [16, 31, 3], [16, 32, 3], [16, 33, 3], [16, 34, 3], // Puntos alrededor de la nariz

        // Rasgos y detalles del Panda Rojo
        [14, 19, 10], [14, 21, 10], // Ojos negros
        [16, 20, 8], // Nariz

        // Manos y corazón
        [27, 20, 8], [27, 21, 8], [27, 22, 8], // Mano mapache
        [27, 23, 1], // Corazón rojo
        [27, 24, 7], [27, 25, 7], [27, 26, 7], // Mano panda rojo

        // Colores en la base de las figuras
        [26, 17, 5], [26, 18, 5],
        [25, 18, 5], [25, 19, 5],
        [24, 18, 5], [24, 19, 5], [24, 20, 5],
        [23, 19, 5], [23, 20, 5], [23, 21, 5], [23, 22, 5],
        [22, 20, 5], [22, 21, 5], [22, 22, 5], [22, 23, 5],
        [21, 21, 5], [21, 22, 5], [21, 23, 5],
        [20, 22, 5], [20, 23, 5],
        [19, 23, 5], [19, 24, 5],
        [18, 24, 5],
        [17, 24, 5],

        // Resto de la matriz para cubrir la figura completa
        [16, 25, 6], [16, 26, 6],
        [17, 25, 6], [17, 26, 6],
        [18, 25, 6], [18, 26, 6],
        [19, 25, 6], [19, 26, 6],
        [20, 25, 6], [20, 26, 6],
        [21, 25, 6], [21, 26, 6],
        [22, 25, 6], [22, 26, 6],
        [23, 25, 6], [23, 26, 6],
        [24, 25, 6], [24, 26, 6],
        [25, 25, 6], [25, 26, 6],
        [26, 25, 6], [26, 26, 6],

        [27, 26, 6], [27, 27, 6], [27, 28, 6],
        [28, 27, 6], [28, 28, 6], [28, 29, 6],
        [29, 27, 6], [29, 28, 6], [29, 29, 6], [29, 30, 6],
        [30, 28, 6], [30, 29, 6], [30, 30, 6],
        [31, 29, 6], [31, 30, 6],
        [32, 29, 6], [32, 30, 6],

        // Rellenos con los colores específicos
        [14, 18, 7], [14, 19, 7], [14, 20, 7], [14, 21, 7],
        [15, 17, 8], [15, 18, 8], [15, 19, 8], [15, 20, 8], [15, 21, 8], [15, 22, 8], [15, 23, 8],
        [16, 16, 8], [16, 17, 8], [16, 18, 8], [16, 19, 8], [16, 20, 8], [16, 21, 8], [16, 22, 8], [16, 23, 8], [16, 24, 8], [16, 25, 8],
        [17, 15, 8], [17, 16, 8], [17, 17, 8], [17, 18, 8], [17, 19, 8], [17, 20, 8], [17, 21, 8], [17, 22, 8], [17, 23, 8], [17, 24, 8], [17, 25, 8],
        [18, 14, 8], [18, 15, 8], [18, 16, 8], [18, 17, 8], [18, 18, 8], [18, 19, 8], [18, 20, 8], [18, 21, 8], [18, 22, 8], [18, 23, 8], [18, 24, 8], [18, 25, 8],
        [19, 13, 8], [19, 14, 8], [19, 15, 8], [19, 16, 8], [19, 17, 8], [19, 18, 8], [19, 19, 8], [19, 20, 8], [19, 21, 8], [19, 22, 8], [19, 23, 8],
        [20, 14, 8], [20, 15, 8], [20, 16, 8], [20, 17, 8], [20, 18, 8], [20, 19, 8], [20, 20, 8], [20, 21, 8], [20, 22, 8],
        [21, 15, 8], [21, 16, 8], [21, 17, 8], [21, 18, 8], [21, 19, 8], [21, 20, 8],
        [22, 16, 8], [22, 17, 8], [22, 18, 8], [22, 19, 8],
        [23, 17, 8], [23, 18, 8], [23, 19, 8],
        [24, 18, 8], [24, 19, 8],

        // Rellenos Mapache
        [15, 30, 9], [15, 31, 9], [15, 32, 9], [15, 33, 9], [15, 34, 9], [15, 35, 9], [15, 36, 9],
        [16, 30, 9], [16, 31, 9], [16, 32, 9], [16, 33, 9], [16, 34, 9], [16, 35, 9], [16, 36, 9],
        [17, 29, 9], [17, 30, 9], [17, 31, 9], [17, 32, 9], [17, 33, 9], [17, 34, 9], [17, 35, 9], [17, 36, 9], [17, 37, 9],
        [18, 29, 9], [18, 30, 9], [18, 31, 9], [18, 32, 9], [18, 33, 9], [18, 34, 9], [18, 35, 9], [18, 36, 9], [18, 37, 9],
        [19, 29, 9], [19, 30, 9], [19, 31, 9], [19, 32, 9], [19, 33, 9], [19, 34, 9], [19, 35, 9], [19, 36, 9], [19, 37, 9],
        [20, 30, 9], [20, 31, 9], [20, 32, 9], [20, 33, 9], [20, 34, 9], [20, 35, 9], [20, 36, 9], [20, 37, 9],
        [21, 31, 9], [21, 32, 9], [21, 33, 9], [21, 34, 9], [21, 35, 9], [21, 36, 9],
        [22, 32, 9], [22, 33, 9], [22, 34, 9], [22, 35, 9],
        [23, 33, 9], [23, 34, 9],

        // Base de las figuras
        [27, 23, 4], [27, 24, 4], [27, 25, 4], [27, 26, 4], [27, 27, 4], [27, 28, 4],
        [28, 24, 4], [28, 25, 4], [28, 26, 4], [28, 27, 4], [28, 28, 4],
        [29, 25, 4], [29, 26, 4], [29, 27, 4], [29, 28, 4],
        [30, 26, 4], [30, 27, 4], [30, 28, 4],
        [31, 27, 4], [31, 28, 4],
        [32, 27, 4], [32, 28, 4],

        // Relleno de las manos
        [27, 20, 5], [27, 21, 5], [27, 22, 5],
        [27, 23, 5], [27, 24, 5], [27, 25, 5],
        [28, 21, 5], [28, 22, 5], [28, 23, 5], [28, 24, 5],
        [29, 22, 5], [29, 23, 5],
        [30, 23, 5],

        // Relleno del corazón
        [27, 23, 1], [27, 24, 1],
        [28, 22, 1], [28, 23, 1], [28, 24, 1],
        [29, 23, 1]
    ];


    for(let i = 0; i < patternData.length; i++) {
        const row = patternData[i];
        const rowIndex = row[0];
        const colIndex = row[1];
        const colorValue = row[2];
        imagePattern[rowIndex][colIndex] = colorValue;
    }

    let totalPintables = 0;
    imagePattern.forEach(row => {
        row.forEach(val => {
            if (val !== 0) totalPintables++;
        });
    });

    function createGrid() {
        const gridSize = 50;
        const pixelSize = window.innerWidth > 768 ? 15 : 12;

        pixelGrid.style.gridTemplateColumns = `repeat(${gridSize}, ${pixelSize}px)`;

        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                const pixel = document.createElement('div');
                pixel.classList.add('pixel');
                const pixelValue = imagePattern[i][j];
                pixel.dataset.value = pixelValue;
                pixel.dataset.row = i;
                pixel.dataset.col = j;

                if (pixelValue !== 0) {
                    pixel.textContent = pixelValue;
                    pixel.addEventListener('click', () => handlePixelClick(pixel));
                }

                pixelGrid.appendChild(pixel);
            }
        }
    }

    function handlePixelClick(pixel) {
        const requiredColor = pixel.dataset.value;
        if (selectedColor && selectedColor == requiredColor) {
            pixel.style.backgroundColor = colors[selectedColor];
            pixel.textContent = '';
            pixel.classList.add('colored');
            paintedPixelsCount++;
            checkCompletion();
        }
    }

    function checkCompletion() {
        if (paintedPixelsCount >= totalPintables) {
            completionMessage.style.display = 'block';
        }
    }

    colorButtons.forEach(button => {
        button.addEventListener('click', () => {
            selectedColor = button.dataset.color;
            colorButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        });
    });

    createGrid();
});
